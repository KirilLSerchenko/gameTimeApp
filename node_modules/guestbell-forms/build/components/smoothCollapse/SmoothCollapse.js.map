{"version":3,"sources":["../../../src/lib/components/smoothCollapse/SmoothCollapse.tsx"],"names":["SmoothCollapse","props","el","_mainEl","_innerEl","state","hasBeenVisibleBefore","expanded","_visibleWhenClosed","fullyClosed","height","collapsedHeight","parseFloat","_resetter","emit","nextProps","setState","mainEl","innerEl","Error","targetHeight","clientHeight","Kefir","fromEvents","merge","later","heightTransition","takeUntilBy","take","onValue","onChangeEnd","visibleWhenClosed","allowOverflowWhenOpen","_innerElSetter","overflow","children","_mainElSetter","className","display","transition","React","PureComponent"],"mappings":"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","sourcesContent":["// lib copied from https://github.com/StreakYC/react-smooth-collapse because the npm package they provide didn't work with webpack 4\r\n\r\nimport * as React from 'react';\r\nimport Kefir from 'kefir';\r\nimport kefirBus from 'kefir-bus';\r\n\r\nimport getTransitionTimeMs from './getTransitionTimeMs';\r\n\r\nexport type SmoothCollapseProps = {\r\n  expanded: boolean;\r\n  onChangeEnd?: () => void;\r\n  collapsedHeight?: string;\r\n  heightTransition?: string;\r\n  className?: string;\r\n  allowOverflowWhenOpen?: boolean;\r\n};\r\ntype State = {\r\n  hasBeenVisibleBefore: boolean;\r\n  fullyClosed: boolean;\r\n  height: string;\r\n};\r\n\r\nexport class SmoothCollapse extends React.PureComponent<SmoothCollapseProps, State> {\r\n  static defaultProps = {\r\n    collapsedHeight: '0',\r\n    heightTransition: '.25s ease',\r\n    className: '',\r\n    allowOverflowWhenOpen: false,\r\n  };\r\n  _resetter = kefirBus();\r\n  _mainEl: HTMLElement = null;\r\n  _innerEl: HTMLElement = null;\r\n  _mainElSetter = (el?: HTMLElement) => {\r\n    this._mainEl = el;\r\n  }\r\n  _innerElSetter = (el?: HTMLElement) => {\r\n    this._innerEl = el;\r\n  }\r\n\r\n  constructor(props: SmoothCollapseProps) {\r\n    super(props);\r\n    this.state = {\r\n      hasBeenVisibleBefore: props.expanded || this._visibleWhenClosed(props),\r\n      fullyClosed: !props.expanded,\r\n      height: props.expanded ? 'auto' : props.collapsedHeight\r\n    };\r\n  }\r\n\r\n  _visibleWhenClosed(props?: SmoothCollapseProps) {\r\n    if (!props) {\r\n      props = this.props;\r\n    }\r\n    return parseFloat(props.collapsedHeight) !== 0;\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    this._resetter.emit(null);\r\n  }\r\n\r\n  componentWillReceiveProps(nextProps: SmoothCollapseProps) {\r\n    if (!this.props.expanded && nextProps.expanded) {\r\n      this._resetter.emit(null);\r\n\r\n      // In order to expand, we need to know the height of the children, so we\r\n      // need to setState first so they get rendered before we continue.\r\n\r\n      this.setState({\r\n        fullyClosed: false,\r\n        hasBeenVisibleBefore: true\r\n      }, () => {\r\n        const mainEl = this._mainEl;\r\n        const innerEl = this._innerEl;\r\n        if (!mainEl || !innerEl) { throw new Error('Should not happen'); }\r\n\r\n        // Set the collapser to the target height instead of auto so that it\r\n        // animates correctly. Then switch it to 'auto' after the animation so\r\n        // that it flows correctly if the page is resized.\r\n        const targetHeight = `${innerEl.clientHeight}px`;\r\n        this.setState({\r\n          height: targetHeight\r\n        });\r\n\r\n        // Wait until the transitionend event, or until a timer goes off in\r\n        // case the event doesn't fire because the browser doesn't support it\r\n        // or the element is hidden before it happens. The timer is a little\r\n        // longer than the transition is supposed to take to make sure we don't\r\n        // cut the animation early while it's still going if the browser is\r\n        // running it just a little slow.\r\n        Kefir.fromEvents(mainEl, 'transitionend')\r\n          .merge(Kefir.later(getTransitionTimeMs(nextProps.heightTransition) * 1.1 + 500))\r\n          .takeUntilBy(this._resetter)\r\n          .take(1)\r\n          .onValue(() => {\r\n            this.setState({\r\n              height: 'auto'\r\n            }, () => {\r\n              if (this.props.onChangeEnd) {\r\n                this.props.onChangeEnd();\r\n              }\r\n            });\r\n          });\r\n      });\r\n\r\n    } else if (this.props.expanded && !nextProps.expanded) {\r\n      this._resetter.emit(null);\r\n\r\n      if (!this._innerEl) { throw new Error('Should not happen'); }\r\n      this.setState({\r\n        height: `${this._innerEl.clientHeight}px`\r\n      }, () => {\r\n        const mainEl = this._mainEl;\r\n        if (!mainEl) { throw new Error('Should not happen'); }\r\n\r\n        // tslint:disable-next-line:no-unused-expression\r\n        mainEl.clientHeight; // force the page layout\r\n        this.setState({\r\n          height: nextProps.collapsedHeight\r\n        });\r\n\r\n        // See comment above about previous use of transitionend event.\r\n        Kefir.fromEvents(mainEl, 'transitionend')\r\n          .merge(Kefir.later(getTransitionTimeMs(nextProps.heightTransition) * 1.1 + 500))\r\n          .takeUntilBy(this._resetter)\r\n          .take(1)\r\n          .onValue(() => {\r\n            this.setState({\r\n              fullyClosed: true\r\n            });\r\n            if (this.props.onChangeEnd) {\r\n              this.props.onChangeEnd();\r\n            }\r\n          });\r\n      });\r\n    } else if (!nextProps.expanded && this.props.collapsedHeight !== nextProps.collapsedHeight) {\r\n      this.setState({\r\n        hasBeenVisibleBefore:\r\n          this.state.hasBeenVisibleBefore || this._visibleWhenClosed(nextProps),\r\n        height: nextProps.collapsedHeight\r\n      });\r\n    }\r\n  }\r\n\r\n  render() {\r\n    const visibleWhenClosed = this._visibleWhenClosed();\r\n    const { allowOverflowWhenOpen } = this.props;\r\n    const { height, fullyClosed, hasBeenVisibleBefore } = this.state;\r\n    const innerEl = hasBeenVisibleBefore ? (\r\n      <div\r\n        ref={this._innerElSetter}\r\n        style={{\r\n          overflow: allowOverflowWhenOpen && height === 'auto' ? 'visible' : 'hidden'\r\n        }}\r\n      >\r\n        {this.props.children}\r\n      </div>\r\n    )\r\n      : null;\r\n\r\n    return (\r\n      <div\r\n        ref={this._mainElSetter}\r\n        className={this.props.className}\r\n        style={{\r\n          height,\r\n          overflow: allowOverflowWhenOpen && height === 'auto' ? 'visible' : 'hidden',\r\n          display: (fullyClosed && !visibleWhenClosed) ? 'none' : null,\r\n          transition: `height ${this.props.heightTransition}`\r\n        }}\r\n      >\r\n        {innerEl}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default SmoothCollapse;"],"file":"SmoothCollapse.js"}