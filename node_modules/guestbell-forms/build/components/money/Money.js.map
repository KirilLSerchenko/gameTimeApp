{"version":3,"sources":["../../../src/lib/components/money/Money.tsx"],"names":["PlusIcon","MoneyRaw","props","index","currentCurrencies","e","newPrices","concat","prices","currency","filter","cc","value","toString","target","onPricesChange","num","Number","parts","split","length","isNaN","str","state","touched","touch","price","itemIndex","required","setInvalid","unusedCurrencies","setValid","setState","focused","currencies","Error","Object","assign","isValid","errors","handleValueChangeEnabled","subscribeSelf","title","getValidationClass","className","containerRef","map","item","priceCurrency","priceIndex","retComponents","onFocus","onBlur","onCurrencyChanged","onTheFlightValidate","onPriceChanged","removePriceClick","allowMultiple","addPriceClick","renderDefaultValidation","label","renderLabel","BaseInput","defaultProps","type","Money"],"mappings":";;;;;;;AAGA;;AAGA;;AACA;;AACA;;AACA;;AACA;;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;IAXaA,Q,YAAAA,Q;;;;;;AAAAA,Q;;;;;GAEb;;IA+BaC,Q;;;;;AAGX,oBAAYC,KAAZ,EAAkC;AAAA;;AAAA;;AAChC,kFAAMA,KAAN,EAAa,KAAb;;AADgC,gGAsFN,UAACC,KAAD,EAAgBC,iBAAhB;AAAA,aAAqD,UAACC,CAAD,EAAO;AACtF,YAAIC,SAA8B,GAAG,GAAGC,MAAH,CAAU,MAAKL,KAAL,CAAWM,MAArB,CAArC;AACAF,QAAAA,SAAS,CAACH,KAAD,CAAT,CAAiBM,QAAjB,GAA4BL,iBAAiB,CAACM,MAAlB,CAAyB,UAAAC,EAAE;AAAA,iBAAIA,EAAE,CAACC,KAAH,CAASC,QAAT,OAAwBR,CAAC,CAACS,MAAF,CAASF,KAArC;AAAA,SAA3B,EAAuE,CAAvE,CAA5B;;AACA,cAAKV,KAAL,CAAWa,cAAX,CAA0BT,SAA1B;AACD,OAJ2B;AAAA,KAtFM;;AAAA,kGA4FJ,UAAAM,KAAK,EAAI;AACrC,UAAII,GAAG,GAAGC,MAAM,CAACL,KAAD,CAAhB;AACA,UAAMM,KAAK,GAAGN,KAAK,CAACO,KAAN,CAAY,GAAZ,CAAd;;AACA,UAAID,KAAK,IAAIA,KAAK,CAACE,MAAN,GAAe,CAAxB,IAA6BF,KAAK,CAACA,KAAK,CAACE,MAAN,GAAe,CAAhB,CAAL,CAAwBA,MAAxB,GAAiC,CAAlE,EAAqE;AACnE,eAAO,KAAP;AACD;;AACD,UAAI,CAACC,KAAK,CAACL,GAAD,CAAV,EAAiB;AACf,eAAO,IAAP;AACD;;AACD,UAAIA,GAAJ,EAAS;AACP,eAAO,KAAP;AACD;AACF,KAxGiC;;AAAA,6FA0GT,UAACb,KAAD;AAAA,aAAmB,UAACE,CAAD,EAA4C;AACtF,YAAIC,SAA8B,GAAG,GAAGC,MAAH,CAAU,MAAKL,KAAL,CAAWM,MAArB,CAArC;AACA,YAAIc,GAAG,GAAGjB,CAAC,CAACS,MAAF,CAASF,KAAnB;AACA,YAAII,GAAG,GAAGC,MAAM,CAACK,GAAD,CAAhB;;AACA,YAAI,CAACD,KAAK,CAACL,GAAD,CAAV,EAAiB;AACfV,UAAAA,SAAS,CAACH,KAAD,CAAT,CAAiBS,KAAjB,GAAyBI,GAAzB;AACD;;AACD,cAAKd,KAAL,CAAWa,cAAX,CAA0BT,SAA1B;;AACA,YAAI,CAAC,MAAKiB,KAAL,CAAWC,OAAhB,EAAyB;AACvB,gBAAKC,KAAL;AACD;AACF,OAXwB;AAAA,KA1GS;;AAAA,+FAuHP,UAACtB,KAAD;AAAA,aAAmB,YAAM;AAClD,YAAMG,SAAS,GAAG,MAAKJ,KAAL,CAAWM,MAAX,CAAkBE,MAAlB,CAAyB,UAACgB,KAAD,EAAQC,SAAR;AAAA,iBAAsBA,SAAS,KAAKxB,KAApC;AAAA,SAAzB,CAAlB;;AACA,cAAKD,KAAL,CAAWa,cAAX,CAA0BT,SAA1B;;AACA,YAAIA,SAAS,CAACc,MAAV,KAAqB,CAArB,IAA0B,MAAKlB,KAAL,CAAW0B,QAAzC,EAAmD;AACjD,gBAAKC,UAAL,CAAgB,CAAC,UAAD,CAAhB;AACD;;AACD,YAAI,CAAC,MAAKN,KAAL,CAAWC,OAAhB,EAAyB;AACvB,gBAAKC,KAAL;AACD;AACF,OAT0B;AAAA,KAvHO;;AAAA,4FAkIV,UAACK,gBAAD;AAAA,aAAqC,YAAM;AACjE,cAAK5B,KAAL,CAAWa,cAAX,CAA0B,MAAKb,KAAL,CAAWM,MAAX,CAAkBD,MAAlB,CAAyB,CAAC;AAAEK,UAAAA,KAAK,EAAE,CAAT;AAAYH,UAAAA,QAAQ,EAAEqB,gBAAgB,CAAC,CAAD;AAAtC,SAAD,CAAzB,CAA1B;;AACA,cAAKC,QAAL;;AACA,YAAI,CAAC,MAAKR,KAAL,CAAWC,OAAhB,EAAyB;AACvB,gBAAKC,KAAL;AACD;AACF,OANuB;AAAA,KAlIU;;AAAA,sFA0IhB;AAAA,aAAM,MAAKO,QAAL,CAAc;AAAEC,QAAAA,OAAO,EAAE;AAAX,OAAd,CAAN;AAAA,KA1IgB;;AAAA,qFA4IjB;AAAA,aAAM,MAAKD,QAAL,CAAc;AAAEC,QAAAA,OAAO,EAAE;AAAX,OAAd,CAAN;AAAA,KA5IiB;;AAEhC,QAAI,CAAC/B,KAAK,CAACgC,UAAP,IAAqB,CAAChC,KAAK,CAACgC,UAAN,CAAiBd,MAA3C,EAAmD;AACjD,YAAMe,KAAK,CAAC,uCAAD,CAAX;AACD;;AACD,UAAKZ,KAAL,GAAaa,MAAM,CAACC,MAAP,CAAc,MAAKd,KAAnB,EAA0B;AACrCe,MAAAA,OAAO,EAAEpC,KAAK,CAAC0B,QAAN,GAAiB1B,KAAK,CAACM,MAAN,CAAaY,MAAb,GAAsB,CAAvC,GAA2C,IADf;AAErCmB,MAAAA,MAAM,EAAErC,KAAK,CAAC0B,QAAN,IAAkB1B,KAAK,CAACM,MAAN,CAAaY,MAAb,KAAwB,CAA1C,GAA8C,CAAC,UAAD,CAA9C,GAA6D,EAFhC;AAGrCoB,MAAAA,wBAAwB,EAAE;AAHW,KAA1B,CAAb;;AAKA,UAAKC,aAAL,CAAmBvC,KAAnB;;AAVgC;AAWjC;;;;6BAEe;AAAA;;AACd,UAAI4B,gBAAgB,GAAG,KAAK5B,KAAL,CAAWgC,UAAlC;AACA,aACE,oBAAC,mBAAD;AAAY,QAAA,KAAK,EAAE,KAAKhC,KAAL,CAAWwC;AAA9B,SACE;AACE,QAAA,SAAS,EAAE,6BAA6B,KAAKC,kBAAL,EAA7B,IAA0D,KAAKzC,KAAL,CAAW0C,SAAX,GAAuB,MAAM,KAAK1C,KAAL,CAAW0C,SAAxC,GAAoD,EAA9G,CADb;AAEE,QAAA,GAAG,EAAE,KAAKC;AAFZ,SAIG,KAAK3C,KAAL,CAAWM,MAAX,IAAqB,KAAKN,KAAL,CAAWM,MAAX,CAAkBsC,GAAlB,CAAsB,UAACC,IAAD,EAAO5C,KAAP,EAAiB;AAC3D,YAAIC,iBAAiB,GAAG,MAAI,CAACF,KAAL,CAAWgC,UAAX,CACtBxB,MADsB,CACf,UAAAD,QAAQ;AAAA,iBAAI,MAAI,CAACP,KAAL,CAAWM,MAAX,CACjBE,MADiB,CACV,UAACsC,aAAD,EAAgBC,UAAhB;AAAA,mBAA+BA,UAAU,KAAK9C,KAAf,IAAwB6C,aAAa,CAACvC,QAAd,CAAuBG,KAAvB,KAAiCH,QAAQ,CAACG,KAAjG;AAAA,WADU,EAC8FQ,MAD9F,KACyG,CAD7G;AAAA,SADO,CAAxB;;AAGA,YAAI8B,aAAa,GAAG9C,iBAAiB,CAACgB,MAAlB,GAA2B;AAAK,UAAA,GAAG,EAAEjB;AAAV,WAC7C,oBAAC,cAAD;AACE,UAAA,OAAO,EAAE,MAAI,CAACgD,OADhB;AAEE,UAAA,MAAM,EAAE,MAAI,CAACC,MAFf;AAGE,UAAA,SAAS,EAAE,yBAHb;AAIE,UAAA,MAAM,EAAEhD,iBAJV;AAKE,UAAA,QAAQ,EAAE,MAAI,CAACiD,iBAAL,CAAuBlD,KAAvB,EAA8BC,iBAA9B,CALZ;AAME,UAAA,KAAK,EAAE2C,IAAI,CAACtC,QAAL,CAAcG,KAAd,CAAoBC,QAApB;AANT,UAD6C,EAS7C,oBAAC,UAAD;AACE,UAAA,OAAO,EAAE,MAAI,CAACsC,OADhB;AAEE,UAAA,MAAM,EAAE,MAAI,CAACC,MAFf;AAGE,UAAA,mBAAmB,EAAE,MAAI,CAACE,mBAH5B;AAIE,UAAA,WAAW,EAAE,MAJf;AAKE,UAAA,SAAS,EAAE,uBALb;AAME,UAAA,UAAU,EAAE,CAAC,QAAD,CANd;AAOE,UAAA,KAAK,EAAEP,IAAI,CAACnC,KAAL,GAAamC,IAAI,CAACnC,KAAL,CAAWC,QAAX,EAAb,GAAqC,EAP9C;AAQE,UAAA,QAAQ,EAAE,MAAI,CAAC0C,cAAL,CAAoBpD,KAApB,CARZ;AASE,UAAA,IAAI,EAAC;AATP,UAT6C,EAoB5C,MAAI,CAACD,KAAL,CAAWM,MAAX,CAAkBY,MAAlB,GAA2B,CAA3B,IACC,oBAAC,cAAD;AACE,UAAA,KAAK,EAAE,IADT;AAEE,UAAA,IAAI,EAAC,OAFP;AAGE,UAAA,OAAO,EAAE,MAAI,CAACoC,gBAAL,CAAsBrD,KAAtB,CAHX;AAIE,UAAA,SAAS,EAAC,qCAJZ;AAKE,UAAA,WAAW,EAAE;AAAEuC,YAAAA,KAAK,EAAE;AAAT,WALf;AAME,UAAA,QAAQ,EAAE;AANZ,WAQE,oBAAC,QAAD,OARF,CArB2C,CAA3B,GAgCX,IAhCT;AAiCAZ,QAAAA,gBAAgB,GAAGA,gBAAgB,CAACpB,MAAjB,CAAwB,UAAAD,QAAQ;AAAA,iBAAIA,QAAQ,CAACG,KAAT,KAAmBmC,IAAI,CAACtC,QAAL,CAAcG,KAArC;AAAA,SAAhC,CAAnB;AACA,eAAOsC,aAAP;AACD,OAvCqB,CAJxB,EA4CG,CAAC,KAAKhD,KAAL,CAAWuD,aAAX,IAA4B,KAAKvD,KAAL,CAAWM,MAAX,IAAqB,CAAC,KAAKN,KAAL,CAAWM,MAAX,CAAkBY,MAArE,KAAgFU,gBAAgB,CAACV,MAAjG,GAEG,oBAAC,cAAD;AACE,QAAA,KAAK,EAAE,IADT;AAEE,QAAA,IAAI,EAAC,SAFP;AAGE,QAAA,SAAS,EAAC,gBAHZ;AAIE,QAAA,OAAO,EAAE,KAAKsC,aAAL,CAAmB5B,gBAAnB,CAJX;AAKE,QAAA,QAAQ,EAAE,IALZ;AAME,QAAA,WAAW,EAAE;AAAEY,UAAAA,KAAK,EAAG,KAAKxC,KAAL,CAAWM,MAAX,IAAqB,KAAKN,KAAL,CAAWM,MAAX,CAAkBY,MAAlB,KAA6B,CAAlD,GAAsD,WAAtD,GAAoE;AAA9E;AANf,SAQE,oBAAC,QAAD,OARF,CAFH,GAcC,IA1DJ,EA4DE;AAAM,QAAA,SAAS,EAAC;AAAhB,QA5DF,EA6DE;AAAM,QAAA,SAAS,EAAE,UAAU,KAAKG,KAAL,CAAWU,OAAX,GAAqB,SAArB,GAAiC,EAA3C;AAAjB,QA7DF,EA8DG,KAAK0B,uBAAL,EA9DH,EA+DG,KAAKzD,KAAL,CAAW0D,KAAX,IAAoB;AAAO,QAAA,SAAS,EAAE,KAAK1D,KAAL,CAAWM,MAAX,IAAqB,KAAKN,KAAL,CAAWM,MAAhC,GAAyC,gBAAzC,GAA4D;AAA9E,SAAmF,KAAKqD,WAAL,EAAnF,CA/DvB,CADF,CADF;AAqED;;;;EAvF2BC,qB;;;;gBAAjB7D,Q,kBACkBmC,MAAM,CAACC,MAAP,CAAc,EAAd,EAAkByB,sBAAUC,YAA5B,EAA0C;AAAEC,EAAAA,IAAI,EAAE,OAAR;AAAiBP,EAAAA,aAAa,EAAE;AAAhC,CAA1C,C;;AAiJxB,IAAMQ,KAAK,GAAG,sCAA2ChE,QAA3C,CAAd;;eAEQgE,K","sourcesContent":["ï»¿import * as PlusIcon from 'material-design-icons/content/svg/production/ic_add_24px.svg';\r\n\r\n// Libs\r\nimport * as React from 'react';\r\n\r\n// Misc\r\nimport { Select, SelectValue } from '../select/Select';\r\nimport { Text } from '../text/Text';\r\nimport InputGroup from '../inputGroup/InputGroup';\r\nimport { BaseInputProps, BaseInputState, BaseInput } from '../base/input/BaseInput';\r\nimport { Button } from '../button/Button';\r\nimport { withFormContext } from '../form/withFormContext';\r\nimport { OmitFormContext } from '../form/FormContext';\r\nimport { InnerRefProps } from './../../types/InnerRefProps';\r\n\r\nexport interface MoneyWithCurrency {\r\n  value: number;\r\n  currency: SelectValue;\r\n}\r\n\r\nexport interface MoneyRawProps extends BaseInputProps<never> {\r\n  onChange?: (e: React.ChangeEvent<HTMLInputElement>) => void;\r\n  onPricesChange: (prices: MoneyWithCurrency[]) => void;\r\n  allowMultiple?: boolean;\r\n  currencies: SelectValue[];\r\n  prices: MoneyWithCurrency[];\r\n}\r\n\r\nexport type MoneyProps = OmitFormContext<MoneyRawProps> & InnerRefProps<MoneyRaw>;\r\n\r\nexport interface MoneyState extends BaseInputState {\r\n}\r\n\r\nexport class MoneyRaw extends BaseInput<MoneyRawProps, MoneyState, never>  {\r\n  public static defaultProps = Object.assign({}, BaseInput.defaultProps, { type: 'money', allowMultiple: false });\r\n\r\n  constructor(props: MoneyRawProps) {\r\n    super(props, false);\r\n    if (!props.currencies || !props.currencies.length) {\r\n      throw Error('No currencies supplied to money input');\r\n    }\r\n    this.state = Object.assign(this.state, {\r\n      isValid: props.required ? props.prices.length > 0 : true,\r\n      errors: props.required && props.prices.length === 0 ? ['Required'] : [],\r\n      handleValueChangeEnabled: false\r\n    });\r\n    this.subscribeSelf(props);\r\n  }\r\n\r\n  public render() {\r\n    let unusedCurrencies = this.props.currencies;\r\n    return (\r\n      <InputGroup title={this.props.title}>\r\n        <div\r\n          className={'input__base money-input ' + this.getValidationClass() + (this.props.className ? ' ' + this.props.className : '')}\r\n          ref={this.containerRef}\r\n        >\r\n          {this.props.prices && this.props.prices.map((item, index) => {\r\n            let currentCurrencies = this.props.currencies.\r\n              filter(currency => this.props.prices.\r\n                filter((priceCurrency, priceIndex) => priceIndex !== index && priceCurrency.currency.value === currency.value).length === 0);\r\n            let retComponents = currentCurrencies.length ? <div key={index}>\r\n              <Select\r\n                onFocus={this.onFocus}\r\n                onBlur={this.onBlur}\r\n                className={'money-input__select m-0'}\r\n                values={currentCurrencies}\r\n                onChange={this.onCurrencyChanged(index, currentCurrencies)}\r\n                value={item.currency.value.toString()}\r\n              />\r\n              <Text\r\n                onFocus={this.onFocus}\r\n                onBlur={this.onBlur}\r\n                onTheFlightValidate={this.onTheFlightValidate}\r\n                placeholder={'0.00'}\r\n                className={'money-input__text m-0'}\r\n                validators={['number']}\r\n                value={item.value ? item.value.toString() : ''}\r\n                onChange={this.onPriceChanged(index)}\r\n                type=\"number\"\r\n              />\r\n              {this.props.prices.length > 0 && (\r\n                <Button\r\n                  blank={true}\r\n                  type=\"error\"\r\n                  onClick={this.removePriceClick(index)}\r\n                  className=\"transform-rotate--45 line-height--0\"\r\n                  buttonProps={{ title: 'Remove price' }}\r\n                  circular={true}\r\n                >\r\n                  <PlusIcon />\r\n                </Button>\r\n              )}\r\n            </div> : null;\r\n            unusedCurrencies = unusedCurrencies.filter(currency => currency.value !== item.currency.value);\r\n            return retComponents;\r\n          })}\r\n          {(this.props.allowMultiple || this.props.prices && !this.props.prices.length) && unusedCurrencies.length ?\r\n            (\r\n              <Button\r\n                blank={true}\r\n                type=\"primary\"\r\n                className=\"line-height--0\"\r\n                onClick={this.addPriceClick(unusedCurrencies)}\r\n                circular={true}\r\n                buttonProps={{ title: (this.props.prices && this.props.prices.length === 0 ? 'Add price' : 'Add new currency') }}\r\n              >\r\n                <PlusIcon />\r\n              </Button>\r\n            )\r\n            :\r\n            null\r\n          }\r\n          <span className=\"highlight\" />\r\n          <span className={'bar ' + (this.state.focused ? 'focused' : '')} />\r\n          {this.renderDefaultValidation()}\r\n          {this.props.label && <label className={this.props.prices && this.props.prices ? 'label--focused' : ''}>{this.renderLabel()}</label>}\r\n        </div>\r\n      </InputGroup>\r\n    );\r\n  }\r\n\r\n  private onCurrencyChanged = (index: number, currentCurrencies: SelectValue[]) => (e) => {\r\n    let newPrices: MoneyWithCurrency[] = [].concat(this.props.prices);\r\n    newPrices[index].currency = currentCurrencies.filter(cc => cc.value.toString() === e.target.value)[0];\r\n    this.props.onPricesChange(newPrices);\r\n  }\r\n\r\n  private onTheFlightValidate = value => {\r\n    let num = Number(value);\r\n    const parts = value.split('.');\r\n    if (parts && parts.length > 1 && parts[parts.length - 1].length > 2) {\r\n      return false;\r\n    }\r\n    if (!isNaN(num)) {\r\n      return true;\r\n    }\r\n    if (num) {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  private onPriceChanged = (index: number) => (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    let newPrices: MoneyWithCurrency[] = [].concat(this.props.prices);\r\n    let str = e.target.value;\r\n    let num = Number(str);\r\n    if (!isNaN(num)) {\r\n      newPrices[index].value = num;\r\n    }\r\n    this.props.onPricesChange(newPrices);\r\n    if (!this.state.touched) {\r\n      this.touch();\r\n    }\r\n  }\r\n\r\n  private removePriceClick = (index: number) => () => {\r\n    const newPrices = this.props.prices.filter((price, itemIndex) => itemIndex !== index);\r\n    this.props.onPricesChange(newPrices);\r\n    if (newPrices.length === 0 && this.props.required) {\r\n      this.setInvalid(['Required']);\r\n    }\r\n    if (!this.state.touched) {\r\n      this.touch();\r\n    }\r\n  }\r\n\r\n  private addPriceClick = (unusedCurrencies: SelectValue[]) => () => {\r\n    this.props.onPricesChange(this.props.prices.concat([{ value: 0, currency: unusedCurrencies[0] }]));\r\n    this.setValid();\r\n    if (!this.state.touched) {\r\n      this.touch();\r\n    }\r\n  }\r\n\r\n  private onFocus = () => this.setState({ focused: true });\r\n\r\n  private onBlur = () => this.setState({ focused: false });\r\n}\r\n\r\nexport const Money = withFormContext<MoneyRawProps, MoneyProps>(MoneyRaw);\r\n\r\nexport default Money;\r\n"],"file":"Money.js"}